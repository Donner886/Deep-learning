## Root Mean Square Propagation (RMSProp)
RMSProp 是一种自适应学习率优化算法，旨在解决传统梯度下降法在训练深度神经网络时遇到的一些问题。它通过调整每个参数的学习率，使得训练过程更加稳定和高效。
RMSProp 的核心思想是对于频繁更新的参数，降低其学习率，而对于不常更新的参数，增加其学习率。这种方法有助于避免梯度爆炸和梯度消失的问题，从而加速收敛。
1. RMSProp的公式推导过程
    - 1.1 定义问题： 在标准的梯度下降中， 我们使用一个固定的学习率 $\alpha$ 来更新参数 $\theta$：
    $$\theta_{t+1} = \theta_t - \alpha \nabla_{\theta} J(\theta)$$
    其中， $J(\theta)$ 是损失函数， $\nabla_{\theta} J(\theta)$ 是损失函数关于参数 $\theta$ 的梯度。$\theta_{t}$ 是参数在第t次迭代时的值。
    问题在于：  对于所有参数使用相同的学习率 $\alpha$ 。 如果某个参数的梯度一直很大， 那么它的更新步长也会很大， 可能导致训练过程不稳定。 相反， 如果某个参数的梯度一直很小， 那么它的更新步长也会很小， 可能导致训练过程非常缓慢。
    - 1.2 引入指数加权移动平均： 为了解决上述问题， RMSProp 引入了梯度的指数加权移动平均（Exponential Moving Average, EMA）。 具体来说， 我们计算梯度平方的EMA：
    $$s_t = \beta s_{t-1} + (1-\beta) (\nabla_{\theta} J(\theta))^2$$
    其中:
    - $s_t$ 是梯度平方的EMA， 
    - $\beta$ 是一个超参数， 通常取值在0.9到0.99之间。 
    
    这个公式的含义是： 当前的 $s_t$ 是前一时刻的 $s_{t-1}$ 的 $\beta$ 倍加上当前梯度平方的 $(1-\beta)$ 倍。 这样， $s_t$ 会对近期的梯度平方赋予更高的权重， 对较早的梯度平方赋予较低的权重。 
    - 为什么是梯度平方： 使用梯度的平方而不是梯度本身， 是因为我们关心的是梯度的幅度（magnitude）， 而不是方向。 通过平方， 我们可以确保所有的值都是非负的， 这样可以更好地反映梯度的大小。
    - 1.3 更新参数： 有了梯度平方的EMA之后， 我们可以使用它来调整每个参数的学习率。 具体来说， 我们将学习率除以梯度平方的EMA的平方根：
    $$ \theta_{t+1} = \theta_t - \frac{\alpha}{\sqrt{s_t + \epsilon}}(\nabla_{\theta} J(\theta_t))$$
    其中， $\epsilon$ 是一个非常小的常数（例如 $10^{-8}$）， 用于防止除以零。 这个公式的含义是： 如果某个参数的梯度平方的EMA $s_t$ 很大， 那么它的学习率就会被缩小， 反之亦然。这里$\sqrt{s_t + \epsilon}$是否类似于一个L2范数。  这样， RMSProp 能够自适应地调整每个参数的学习率， 从而提高训练的稳定性和效率。
2. RMSProp的优点
### 为什么使用梯度平方的EMA？

- **反映梯度“幅度”而非方向**  
    仅使用梯度的EMA（如 $E[\nabla_\theta J(\theta)]$）会因正负抵消，导致均值趋近于零，无法真实反映梯度的“波动大小”。而使用梯度平方的EMA（如 $E[(\nabla_\theta J(\theta))^2]$）能捕捉到梯度的实际“幅度”，无论正负都计入，更好地衡量参数更新时的“风险”或“剧烈程度”。

- **自适应缩放步长**  
    - 如果某个参数的梯度长期较大，$s_t$（均方）就大，分母大，步长自动变小，避免震荡。  
    - 如果某个参数的梯度长期较小，$s_t$ 就小，分母小，步长自动变大，避免收敛过慢。

- **与标准差的关系**  
    $s_t$ 类似于梯度的“均方根”（RMS），本质上是标准差的近似，能反映梯度的波动性。直接用梯度的EMA无法反映波动性，只能反映平均趋势，容易失真。

- **举例说明**  
    假设梯度在正负之间大幅波动，均值接近0，但实际每次更新都很大。如果用均值，步长会被高估，导致不稳定。用平方的均值，能真实反映“每次更新的实际幅度”，从而合理缩放学习率。

**总结**  
RMSProp 使用梯度平方的EMA，是为了捕捉梯度的真实“幅度”或“能量”，从而自适应地调整每个参数的学习率，提升训练的稳定性和效率。如果只用梯度的EMA，信息会丢失，无法达到自适应的效果。

